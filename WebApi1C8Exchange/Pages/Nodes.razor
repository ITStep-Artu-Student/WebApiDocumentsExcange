@page "/nodes"
@attribute [Authorize(Roles ="Admin")]

@using WebApiDocumentsExchange.Models
@using WebApiDocumentsExchange.Data
@using Microsoft.EntityFrameworkCore

@inherits sabatex.Blazor.UIConrols.BasePage<ClientNode,ExchangeDbContext>

<RadzenButton Icon="add_circle_outline"
              style="margin-bottom: 10px"
              Text="Створити нод"
              Click="@InsertRow"
              Disabled=@(ItemToInsertInGrid != null) />

<RadzenDataGrid Data="@DataGridItems"
                @ref="DataGrid"
                TItem="ClientNode"
                AllowFiltering="true"
                AllowColumnResize="true"
                AllowPaging="true"
                PageSize="10"
                AllowSorting="true"
                EditMode="DataGridEditMode.Single"
                @bind-Value=@DataGridSelectedItems
                RowUpdate="@OnUpdateRow"
                RowCreate="@OnCreateRow">
    <Columns>
         <RadzenDataGridColumn TItem="ClientNode" Property="Name" Title="Name" Width="auto">
            <EditTemplate Context="node">
                <RadzenTextBox @bind-Value="node.Name"  Disabled="node.Name!=null" TValue="string" Width="100%" />
            </EditTemplate>
         </RadzenDataGridColumn>
         <RadzenDataGridColumn TItem="ClientNode"  Property="Description" Title="Description" Width="auto">
            <EditTemplate Context="node">
                <RadzenTextBox @bind-Value="node.Description" TValue="string" Width="100%" />
            </EditTemplate>
         </RadzenDataGridColumn>
         <RadzenDataGridColumn TItem="ClientNode"  Property="Password" Title="Password" Width="auto">
            <EditTemplate Context="node">
                <RadzenTextBox @bind-Value="node.Password" TValue="string" Width="100%" />
            </EditTemplate>
         </RadzenDataGridColumn>
         <RadzenColumnRowControls T="ClientNode" OnCancelEdit="CancelEdit" OnEditRow="EditRow" OnDeleteRow="DeleteRow" OnSaveRow="SaveRow" Width="120px" />
    </Columns>
</RadzenDataGrid>

@code {
    protected override void OnInitialized()
    {
        DataGridItems = dbContext.ClientNodes.OrderByDescending(k => k.Name);
    }
    protected override async Task OnCreateRow(ClientNode item)
    {
        item.Id = item.Name.ToLower();
        await base.OnCreateRow(item);
    }
}
